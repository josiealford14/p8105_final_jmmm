---
title: "Case Study Analysis"
---
We are interested in conducting a case study on pharmaceutical drugs that receive the highest advertisement spending, are the most prescribed according to US sales, are most abused (over prescribed, highly addictive, and/or frequently used as illicit street drugs), and are commonly referenced in everyday life or in popular American culture.

### Most Advertised (by spending)

```{r Most Advertised, warning = FALSE, message = FALSE}
library(tidyverse)
library(tidytext)

library(broom)
library(dplyr)
library(forcats)
library(httr)
library(janitor)
library(knitr)
library(plotly)
library(readxl)
library(rvest)
library(stringr)
library(viridis)
final_dataset = read_csv("./data/final_dataset_20171205.csv")
top_advertising_cost = c("Humira", "Lyrica", "Eliquis", "Xeljanz", "Cialis", "Invokana", "Breo", "Latuda", "Victoza", "Viagra")
top_advertising_cost
```

  
##### Most Prescribed (by sales)

```{r Most Prescribed, warning = FALSE, message = FALSE}
### Top 20 precribed drugs by US sales
top_prescribed_drugs_sales = c("Humira", "Harvoni", "Enbrel", "Lantus Solostar", "Remicade", "Januvia", "Advair Diskus", "Lyrica", "Crestor", "Neulasta", "Copaxone", "Rituxan", "Tecfidera", "Xarelto", "Lantus", "Eliquis", "Truvada", "Vyvanse", "Avastin", "Symbicort")
top_prescribed_drugs_sales
```

##### Most Abused

```{r Most Abused, warning = FALSE, message = FALSE}
most_abused_drugs = c("Vicodin", "OxyContin", "Ritalin", "Concerta", "Focalin", "Metadate", "Ambien", "Lunesta", "Valium", "Xanax", "Duragesic", "Opana", "Darvon", "Dilaudid", "Demerol", "Lomotil", "Nembutal", "Dexedrine", "Adderall", "Percocet", "Suboxone", "Fentanyl") 
#Interested in seeing how prescription opioid prices have increased through time (Muhire's plot) 
most_abused_drugs
```

##### Anecdotal or Commonly Discussed in Popular Culture

```{r Popular Culture, warning = FALSE, message = FALSE}
most_popular_drugs = c("Viagra", "Lipitor", "Xanax", "Celebrex", "Prozac", "Crestor", "Nexium", "Lisinopril", "Zoloft", "Abilify", "Prilosec", "Percocet", "Vicodin", "Zocor")
most_popular_drugs
```

##### Comparing Mean Average Price per Tablet for each Drug Group
  + We compared pricing of the drugs classified in each category.
  
  + The Most Abused Drugs had the lowest mean of average price per tablet of $5.22.
  
  + The Most Advertised and the Most Popular Drugs have similar means of average price per tablet of $25.78 and $22.86, respectively. 
  
  + The Most Prescribed Drugs have the highest mean of average price per tablet of $259.26. 
  
  + These results are particularly interesting. 
  
      + The most abused drugs are relatively inexpensive compared to others. This gives patients greater access to highly addictive prescriptions, including painkillers. This may be a driving force of prescription drug abuse; cheap and highly addictive are fatal combinations for drug dependence.
      
      + The most prescribed drugs are notably more expensive. The mean is skewed by the Hepatitis C drug, Harvoni. Harvoni has a median average price of $1,093.83. Excluding Harvoni results in a mean of average price per tablet of $21.71 for most prescribed drugs, which is on-par with most popular and most advertised drugs. 
      
```{r}
mean_price_abused = final_dataset %>%
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% most_abused_drugs) %>%
  summarize(mean_price = mean(avg_price))
#mean average price of per tablet of most abused drugs is $5.22

mean_price_popular = final_dataset %>%
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% most_popular_drugs) %>%
  summarize(mean_price = mean(avg_price))
#mean average price of per tablet of most abused drugs is $22.86

mean_price_prescribed = final_dataset %>%
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% top_prescribed_drugs_sales) %>%
  filter(trade_name != "Harvoni") %>%
  summarize(mean_price = mean(avg_price))
#mean average price of per tablet of most abused drugs is $259.26
#mean average price of per tablet of most abused drugs is $21.71 when excluding Harvoni, an extreme outlier. 

mean_price_advertised = final_dataset %>%
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% top_advertising_cost) %>%
  summarize(mean_price = mean(avg_price))
#mean average price of per tablet of most abused drugs is $25.78
```

##### Boxplots of each category of drugs

```{r Plottly Formatting, warning = FALSE, message = FALSE}
#plotly formatting
f = list(
  family = "Courier New, monospace",
  size = 18,
  color = "#7f7f7f"
)
trade_name_axis = list(
  title = "Trade Name",
  titlefont = f
)
avg_price_axis = list(
  title = "Average Drug Price",
  titlefont = f
)
```

##### The Distribution of Average Price for Most Advertised Drugs, Ordered by Descending Advertising Spending

  + Elliquis had the highest advertising spending of $174 million, yet had the lowest median of average drug price of $5.28. 
  
  + Xeljanz had the highest median of average drug price of $43.14, among this group. Also, Xeljanz had the most variability in this group.
  
```{r Most Advertised plots, warning = FALSE, message = FALSE}
#shiny application : most advertised (by spending) vs. most abused vs. most prescribed (by sales)
#another shiny application: give list of all "most" drugs and can see boxplot for that specific drug
final_dataset %>%
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% top_advertising_cost) %>%
  ungroup() %>%
  mutate(trade_name = factor(trade_name)) %>%
  mutate(trade_name_new = fct_relevel(trade_name, c("Eliquis", "Xeljanz", "Cialis", "Invokana", "Latuda","Viagra"))) %>%
   group_by(trade_name) %>% 
  plot_ly(x = ~trade_name_new, y = ~avg_price, type = "box", color = ~trade_name, colors = "Set3") %>%
  layout(title = "Distribution of Average Price for Most Advertised Drugs, 
         Ordered by Descending Advertising Spending", xaxis = trade_name_axis, yaxis = avg_price_axis)
```

##### The Distribution of Average Price for Most Popular Drugs

  + Viagra, which treats erectile dysfunction (acute), had the highest median of average price of $35.47. 
  
  + Xanax, which treats anxiety and panic attack (acute), had the lowest median of average price of $3.41.
  
  + There is no clear trend between disease type (acute vs. chronic) and disease condition (i.e: psychiatric drugs vs. cardiovascular).
  
```{r Most Popular, warning = FALSE, message = FALSE}
final_dataset %>%
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% most_popular_drugs) %>%
  plot_ly(y = ~avg_price, type = "box", color = ~trade_name, colors = "Set3") %>%
  layout(title = "Distribution of Average Price for Popular Drugs", xaxis = trade_name_axis, yaxis = avg_price_axis)
```

##### The Distribution of Average Price for Most Abused Drugs 

  + Ambien and Lunesta, which both treat sleep disorders, have the highest median of average drug price per dose of $13.45 and $11.94 respectively. Focalin and Ritalin, which both treat ADHD, have the lowest median of average drug price per dose of $0.97 each. 
  
```{r Case Study Analysis, warning = FALSE, message = FALSE}
final_dataset %>%
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% most_abused_drugs) %>%
  group_by(trade_name) %>% 
  plot_ly(y = ~avg_price, type = "box", color = ~trade_name, colors = "Set3") %>%
  layout(title = "Distribution of Average Price for Most Abused Drugs", xaxis = trade_name_axis, yaxis = avg_price_axis)
```

##### The Distribution of Average Price for Most Prescribed Drugs Ordered by Descending Prescription Rates

  + Harvoni in the most expensive of the most prescribed drugs. Why is a drug that treats Hepatitis C so expensive?
  
  + Some explanation from HuffPost: "There are an estimated three million Americans with hepatitis C; most of them boomer-aged, and most of them donâ€™t know they have it. For 75 to 85 percent of those people, infection will lead to chronic hepatitis-related diseases like liver cancer, cirrhosis or liver disease. In fact, hepatitis C is the most common reason people have liver transplants in the U.S. And the new, better medications that could cure them of this potentially fatal disease are so expensive that government safety nets and private insurance companies are struggling to provide coverage to as many people who need them." 
  
      +https://www.huffingtonpost.com/entry/why-hepatitis-c-drugs-are-expensive_us_5642840be4b08cda34868c8a
    
    + Influences of pricing: uniqueness of the drug, how many other drugs are already available that treat the same condition, competition, have the potential to change the current practice of medicine used to treat the conditions the drugs target, extend or even save lives. 
  
      + https://www.investopedia.com/articles/investing/020316/how-pharmaceutical-companies-price-their-drugs.asp
    
  + If we exclude Harvoni, we can better see the box plots of the other drugs.
  
    + As prescription rates decrease, average drug price per tablet does not display any discernible trend.
    
```{r}
final_dataset %>%
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% top_prescribed_drugs_sales) %>%
  ungroup() %>%
  mutate(trade_name = factor(trade_name)) %>%
  mutate(trade_name_presc = fct_relevel(trade_name, c("Harvoni", "Januvia", "Crestor","Xarelto","Eliquis", "Truvada"))) %>%
  group_by(trade_name) %>% 
  plot_ly(y = ~avg_price, type = "box", color = ~trade_name_presc, colors = "Set3") %>%
  layout(title = "Distribution of Average Price for Most Prescribed Drugs", xaxis = trade_name_axis, yaxis = avg_price_axis)


final_dataset %>% #without harvoni
  filter(!is.na(avg_price)) %>%
  filter(trade_name %in% top_prescribed_drugs_sales) %>%
  filter(trade_name != "Harvoni") %>%
  ungroup() %>%
  mutate(trade_name = factor(trade_name)) %>%
  mutate(trade_name_presc = fct_relevel(trade_name, c("Januvia", "Crestor","Xarelto","Eliquis", "Truvada"))) %>%
  group_by(trade_name) %>% 
  plot_ly(y = ~avg_price, type = "box", color = ~trade_name_presc, colors = "Set3") %>%
  layout(title = "Distribution of Average Price for Most Prescribed Drugs", xaxis = trade_name_axis, yaxis = avg_price_axis)
```
